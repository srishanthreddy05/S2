<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>S2 Hub | Real Arbitrage Trading</title>
  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    :root {
      --bg-dark: #0D0F18;
      --bg-gradient-start: #1A1C2D;
      --bg-gradient-end: #0D0F18;
      --primary-accent: #8A2BE2;
      --secondary-accent: #48C6EF;
      --success: #00C851;
      --warning: #ff6b35;
      --arbitrage: #FFD700;
      --profit: #00FF88;
      --loss: #FF6B6B;
      --glass: rgba(26, 28, 45, 0.65);
      --glass-border: rgba(255, 255, 255, 0.1);
      --shadow: 0 10px 32px 0 rgba(0, 0, 0, 0.35);
      --text-primary: #F0F2F5;
      --text-secondary: #A0AEC0;
      --font-primary: 'Poppins', sans-serif;
      --font-secondary: 'Inter', sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background-color: var(--bg-dark);
      background-image: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      font-family: var(--font-secondary);
      color: var(--text-primary);
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }

    /* Aurora Background Effect */
    body::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60vw;
      height: 60vh;
      max-width: 700px;
      max-height: 700px;
      background-image: radial-gradient(circle, var(--arbitrage), transparent 60%);
      opacity: 0.08;
      filter: blur(120px);
      animation: aurora-pulse 20s infinite alternate ease-in-out;
      z-index: 0;
    }

    @keyframes aurora-pulse {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.05; }
      100% { transform: translate(-45%, -55%) scale(1.2); opacity: 0.12; }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 0;
    }

    .header h1 {
      font-family: var(--font-primary);
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--arbitrage), #FFE135);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-btn {
      padding: 12px 24px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(15px);
    }

    .back-btn:hover {
      background: var(--secondary-accent);
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(72, 198, 239, 0.3);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 25px;
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .stat-card:hover { transform: translateY(-3px); }

    .stat-card h3 {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-card .value {
      font-family: var(--font-primary);
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--arbitrage);
    }

    .profit-value { color: var(--profit) !important; }
    .loss-value { color: var(--loss) !important; }

    /* Controls */
    .controls {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 25px;
      backdrop-filter: blur(15px);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 600;
    }

    select, input {
      padding: 12px 16px;
      background: rgba(26, 28, 45, 0.8);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: var(--font-secondary);
      font-size: 0.95rem;
      min-width: 150px;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--arbitrage);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: var(--font-primary);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--arbitrage), #FFE135);
      color: #1a1a1a;
    }

    .btn-refresh {
      background: var(--secondary-accent);
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Alert Box */
    .alert {
      background: var(--glass);
      border: 1px solid var(--success);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      color: var(--success);
      backdrop-filter: blur(15px);
    }

    .alert h3 {
      color: var(--success);
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .alert p {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    /* Opportunities Table */
    .opportunities-section {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 30px;
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--glass-border);
    }

    .section-header h2 {
      font-family: var(--font-primary);
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse-dot 2s infinite;
    }

    .status-indicator.loading {
      background: var(--warning);
    }

    .status-indicator.error {
      background: var(--loss);
    }

    @keyframes pulse-dot {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.1); }
      100% { opacity: 1; transform: scale(1); }
    }

    .table-container {
      overflow-x: auto;
    }

    .opportunities-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .opportunities-table th,
    .opportunities-table td {
      padding: 15px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .opportunities-table th {
      background: rgba(26, 28, 45, 0.5);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: sticky;
      top: 0;
    }

    .opportunities-table td {
      color: var(--text-primary);
      font-size: 0.9rem;
    }

    .opportunities-table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .coin-cell {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .coin-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
    }

    .price-cell {
      font-family: var(--font-primary);
      font-weight: 600;
    }

    .profit-cell {
      font-family: var(--font-primary);
      font-weight: 700;
    }

    .positive { color: var(--profit); }
    .negative { color: var(--loss); }

    .exchange-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .binance { background: #F3BA2F; color: #000; }
    .coinbase { background: #0052FF; color: white; }
    .kraken { background: #5741D9; color: white; }
    .kucoin { background: #00D4AA; color: #000; }
    .coingecko { background: #8DC63F; color: #000; }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 2rem;
      color: var(--arbitrage);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .no-opportunities {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .error-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--loss);
    }

    .refresh-time {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .data-quality {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .quality-bar {
      width: 100px;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .quality-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--loss), var(--warning), var(--success));
      transition: width 0.3s ease;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      .header h1 {
        font-size: 1.8rem;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .control-group {
        width: 100%;
      }

      .opportunities-table {
        font-size: 0.8rem;
      }

      .opportunities-table th,
      .opportunities-table td {
        padding: 10px 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    
    <!-- Header -->
    <header class="header">
      <h1><i class="fas fa-chart-line-up"></i>Real-Time Arbitrage</h1>
      <a href="#" class="back-btn" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </header>

    <div class="alert">
  <h3><i class="fas fa-rocket"></i> Preparing for Liftoff!</h3>
  <p>You're getting an early look! This is a functional simulation of our powerful arbitrage tool.</p>
  <p>The full platform with real-time trading capabilities is under development. <strong>Get ready, it will be live soon!</strong></p>
</div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Opportunities Found</h3>
        <div class="value" id="activeOpportunities">0</div>
      </div>
      <div class="stat-card">
        <h3>Highest Spread</h3>
        <div class="value profit-value" id="bestMargin">$0.00</div>
      </div>
      <div class="stat-card">
        <h3>Avg Market Spread</h3>
        <div class="value" id="avgSpread">$0.00</div>
      </div>
      <div class="stat-card">
        <h3>Data Quality</h3>
        <div class="value" id="dataQuality">100%</div>
        <div class="data-quality">
          <div class="quality-bar">
            <div class="quality-fill" id="qualityFill" style="width: 100%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="control-group">
        <label>Minimum Spread ($)</label>
        <input type="number" id="minSpread" value="50" min="1" step="10" />
      </div>
      <div class="control-group">
        <label>Trading Pairs</label>
        <select id="pairCount">
          <option value="5">Top 5 Coins</option>
          <option value="10" selected>Top 10 Coins</option>
          <option value="20">Top 20 Coins</option>
        </select>
      </div>
      <div class="control-group">
        <label>Sort By</label>
        <select id="sortBy">
          <option value="spread">Spread Amount</option>
          <option value="percentage">Spread %</option>
          <option value="marketCap">Market Cap</option>
        </select>
      </div>
      <button class="btn btn-refresh" onclick="refreshRealData()" id="refreshBtn">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>

    <!-- Opportunities Section -->
    <div class="opportunities-section">
      <div class="section-header">
        <h2>
          <div class="status-indicator loading" id="statusIndicator"></div>
          Live Price Analysis
        </h2>
        <div class="refresh-time" id="lastUpdate">Initializing...</div>
      </div>

      <div class="table-container">
        <div id="loadingState" class="loading">
          <i class="fas fa-spinner"></i>
          <p>Fetching live cryptocurrency prices...</p>
          <p style="font-size: 0.8rem; margin-top: 10px;">Analyzing market data for arbitrage opportunities</p>
        </div>

        <div id="errorState" class="error-state" style="display: none;">
          <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
          <h3>Connection Error</h3>
          <p>Unable to fetch market data. Please check your internet connection.</p>
          <button class="btn btn-refresh" onclick="refreshRealData()" style="margin-top: 15px;">
            Try Again
          </button>
        </div>

        <div id="noOpportunities" class="no-opportunities" style="display: none;">
          <i class="fas fa-search" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i>
          <h3>No Significant Arbitrage Found</h3>
          <p>Market prices are currently well-aligned. Try lowering the minimum spread threshold.</p>
        </div>

        <table class="opportunities-table" id="opportunitiesTable" style="display: none;">
          <thead>
            <tr>
              <th>Cryptocurrency</th>
              <th>Exchange A</th>
              <th>Price A</th>
              <th>Exchange B</th>
              <th>Price B</th>
              <th>Spread ($)</th>
              <th>Spread %</th>
              <th>Market Cap</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="opportunitiesBody">
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <script>
    // CoinGecko API Configuration (free tier, no API key required)
    const API_BASE = 'https://api.coingecko.com/api/v3';
    
    // Simulated exchange data for realistic arbitrage simulation
    const EXCHANGES = [
      { name: 'Binance', variance: 0.2, bias: -0.1 },
      { name: 'Coinbase', variance: 0.3, bias: 0.15 },
      { name: 'Kraken', variance: 0.25, bias: -0.05 },
      { name: 'KuCoin', variance: 0.4, bias: 0.1 },
      { name: 'Gate.io', variance: 0.5, bias: 0.2 }
    ];

    let marketData = {};
    let opportunities = [];
    let isLoading = false;

    // Fetch live cryptocurrency prices
    async function fetchMarketData() {
      const pairCount = document.getElementById('pairCount').value;
      
      try {
        console.log(`Fetching top ${pairCount} cryptocurrencies...`);
        
        const response = await fetch(
          `${API_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=${pairCount}&page=1&sparkline=false&price_change_percentage=24h`
        );
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('Market data received:', data);
        
        return data.map(coin => ({
          id: coin.id,
          symbol: coin.symbol.toUpperCase(),
          name: coin.name,
          price: coin.current_price,
          market_cap: coin.market_cap,
          change_24h: coin.price_change_percentage_24h,
          image: coin.image
        }));
        
      } catch (error) {
        console.error('Error fetching market data:', error);
        throw error;
      }
    }

    // Generate realistic exchange prices based on market data
    function generateExchangePrices(basePrice, exchangeConfig) {
      const variance = exchangeConfig.variance / 100; // Convert to decimal
      const bias = exchangeConfig.bias / 100;
      
      // Add some randomness but keep it realistic
      const randomFactor = (Math.random() - 0.5) * variance;
      const biasedPrice = basePrice * (1 + bias + randomFactor);
      
      return Math.max(biasedPrice, basePrice * 0.95); // Prevent negative prices
    }

    // Find arbitrage opportunities
    function findArbitrageOpportunities(marketData) {
      const opportunities = [];
      const minSpread = parseFloat(document.getElementById('minSpread').value) || 0;

      marketData.forEach(coin => {
        // Generate prices for different exchanges
        const exchangePrices = EXCHANGES.map(exchange => ({
          exchange: exchange.name,
          price: generateExchangePrices(coin.price, exchange)
        }));

        // Find best buy and sell opportunities
        const sortedPrices = [...exchangePrices].sort((a, b) => a.price - b.price);
        const lowestPrice = sortedPrices[0];
        const highestPrice = sortedPrices[sortedPrices.length - 1];
        
        const spread = highestPrice.price - lowestPrice.price;
        const spreadPercentage = (spread / lowestPrice.price) * 100;

        if (spread >= minSpread) {
          opportunities.push({
            coin: coin,
            buyExchange: lowestPrice.exchange,
            sellExchange: highestPrice.exchange,
            buyPrice: lowestPrice.price,
            sellPrice: highestPrice.price,
            spread: spread,
            spreadPercentage: spreadPercentage,
            marketCap: coin.market_cap,
            timestamp: Date.now()
          });
        }
      });

      return opportunities;
    }

    // Update UI with opportunities
    function updateUI(opportunities) {
      const statusIndicator = document.getElementById('statusIndicator');
      const loadingState = document.getElementById('loadingState');
      const errorState = document.getElementById('errorState');
      const noOpportunities = document.getElementById('noOpportunities');
      const opportunitiesTable = document.getElementById('opportunitiesTable');

      // Hide loading
      loadingState.style.display = 'none';
      errorState.style.display = 'none';

      if (opportunities.length === 0) {
        statusIndicator.className = 'status-indicator';
        noOpportunities.style.display = 'block';
        opportunitiesTable.style.display = 'none';
      } else {
        statusIndicator.className = 'status-indicator';
        noOpportunities.style.display = 'none';
        opportunitiesTable.style.display = 'table';
        
        // Populate table
        populateOpportunitiesTable(opportunities);
      }

      // Update statistics
      updateStatistics(opportunities);
      
      // Update last refresh time
      document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
    }

    // Populate opportunities table
    function populateOpportunitiesTable(opportunities) {
      const tbody = document.getElementById('opportunitiesBody');
      tbody.innerHTML = '';

      // Sort opportunities
      const sortBy = document.getElementById('sortBy').value;
      const sortedOps = [...opportunities];
      
      switch (sortBy) {
        case 'spread':
          sortedOps.sort((a, b) => b.spread - a.spread);
          break;
        case 'percentage':
          sortedOps.sort((a, b) => b.spreadPercentage - a.spreadPercentage);
          break;
        case 'marketCap':
          sortedOps.sort((a, b) => b.marketCap - a.marketCap);
          break;
      }

      sortedOps.forEach(op => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td>
            <div class="coin-cell">
              <img src="${op.coin.image}" alt="${op.coin.symbol}" class="coin-icon" onerror="this.style.display='none'">
              <div>
                <strong>${op.coin.symbol}</strong>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">${op.coin.name}</div>
              </div>
            </div>
          </td>
          <td><span class="exchange-badge ${op.buyExchange.toLowerCase().replace('.', '')}">${op.buyExchange}</span></td>
          <td class="price-cell">$${op.buyPrice.toFixed(4)}</td>
          <td><span class="exchange-badge ${op.sellExchange.toLowerCase().replace('.', '')}">${op.sellExchange}</span></td>
          <td class="price-cell">$${op.sellPrice.toFixed(4)}</td>
          <td class="profit-cell positive">$${op.spread.toFixed(2)}</td>
          <td class="profit-cell positive">${op.spreadPercentage.toFixed(3)}%</td>
          <td>$${(op.marketCap / 1e9).toFixed(1)}B</td>
          <td><span style="color: var(--success);">âœ… Live</span></td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // Update statistics
    function updateStatistics(opportunities) {
      document.getElementById('activeOpportunities').textContent = opportunities.length;
      document.getElementById('dataQuality').textContent = '100%';
      
      if (opportunities.length > 0) {
        const maxSpread = Math.max(...opportunities.map(op => op.spread));
        const avgSpread = opportunities.reduce((sum, op) => sum + op.spread, 0) / opportunities.length;
        
        document.getElementById('bestMargin').textContent = `$${maxSpread.toFixed(2)}`;
        document.getElementById('avgSpread').textContent = `$${avgSpread.toFixed(2)}`;
      } else {
        document.getElementById('bestMargin').textContent = '$0.00';
        document.getElementById('avgSpread').textContent = '$0.00';
      }
      
      // Update quality bar
      document.getElementById('qualityFill').style.width = '100%';
    }

    // Refresh data
    async function refreshRealData() {
      if (isLoading) return;
      
      isLoading = true;
      const refreshBtn = document.getElementById('refreshBtn');
      const statusIndicator = document.getElementById('statusIndicator');
      
      // Update UI for loading state
      refreshBtn.disabled = true;
      refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
      statusIndicator.className = 'status-indicator loading';
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('opportunitiesTable').style.display = 'none';
      document.getElementById('noOpportunities').style.display = 'none';
      document.getElementById('errorState').style.display = 'none';

      try {
        console.log('Starting data refresh...');
        
        // Fetch real market data
        const data = await fetchMarketData();
        marketData = data;
        console.log('Market data processed:', marketData);
        
        // Find arbitrage opportunities
        opportunities = findArbitrageOpportunities(marketData);
        console.log('Opportunities found:', opportunities);
        
        // Update UI
        updateUI(opportunities);
        
      } catch (error) {
        console.error('Error during refresh:', error);
        document.getElementById('statusIndicator').className = 'status-indicator error';
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'block';
      } finally {
        isLoading = false;
        refreshBtn.disabled = false;
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
      }
    }

    // Event listeners
    document.getElementById('minSpread').addEventListener('input', () => {
      if (marketData.length > 0) {
        opportunities = findArbitrageOpportunities(marketData);
        updateUI(opportunities);
      }
    });

    document.getElementById('pairCount').addEventListener('change', refreshRealData);
    
    document.getElementById('sortBy').addEventListener('change', () => {
      if (opportunities.length > 0) {
        updateUI(opportunities);
      }
    });

    // Auto-refresh every 2 minutes to respect API limits
    setInterval(() => {
      if (!isLoading) {
        console.log('Auto-refreshing market data...');
        refreshRealData();
      }
    }, 120000); // 2 minutes

    // Price volatility simulation for more realistic arbitrage
    function addPriceVolatility() {
      if (opportunities.length > 0) {
        opportunities = opportunities.map(op => {
          // Add small random fluctuations to simulate real market movement
          const volatility = 0.1; // 0.1% volatility
          const buyPriceChange = (Math.random() - 0.5) * volatility / 100;
          const sellPriceChange = (Math.random() - 0.5) * volatility / 100;
          
          const newBuyPrice = op.buyPrice * (1 + buyPriceChange);
          const newSellPrice = op.sellPrice * (1 + sellPriceChange);
          const newSpread = newSellPrice - newBuyPrice;
          const newSpreadPercentage = (newSpread / newBuyPrice) * 100;
          
          return {
            ...op,
            buyPrice: newBuyPrice,
            sellPrice: newSellPrice,
            spread: newSpread,
            spreadPercentage: newSpreadPercentage,
            timestamp: Date.now()
          };
        });
        
        // Filter out opportunities that no longer meet minimum spread
        const minSpread = parseFloat(document.getElementById('minSpread').value) || 0;
        opportunities = opportunities.filter(op => op.spread >= minSpread);
        
        // Update UI with new prices
        if (document.getElementById('opportunitiesTable').style.display !== 'none') {
          populateOpportunitiesTable(opportunities);
          updateStatistics(opportunities);
        }
      }
    }

    // Add subtle price movements every 15 seconds
    setInterval(addPriceVolatility, 15000);

    // Enhanced error handling with retry logic
    async function fetchWithRetry(url, maxRetries = 3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          const response = await fetch(url);
          if (response.ok) {
            return response;
          }
          throw new Error(`HTTP ${response.status}`);
        } catch (error) {
          console.warn(`Attempt ${i + 1} failed:`, error.message);
          if (i === maxRetries - 1) throw error;
          
          // Wait before retry (exponential backoff)
          await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
        }
      }
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'r' || e.key === 'R') {
        if (e.ctrlKey || e.metaKey) {
          e.preventDefault();
          refreshRealData();
        }
      }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Initializing Real-Time Arbitrage Platform...');
      
      // Add loading animation to quality bar
      const qualityFill = document.getElementById('qualityFill');
      qualityFill.style.width = '0%';
      
      setTimeout(() => {
        qualityFill.style.width = '100%';
      }, 500);
      
      // Start initial data fetch
      refreshRealData();
    });

    // Utility functions for better UX
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 4
      }).format(amount);
    }

    function formatMarketCap(marketCap) {
      if (marketCap >= 1e12) {
        return `${(marketCap / 1e12).toFixed(1)}T`;
      } else if (marketCap >= 1e9) {
        return `${(marketCap / 1e9).toFixed(1)}B`;
      } else if (marketCap >= 1e6) {
        return `${(marketCap / 1e6).toFixed(1)}M`;
      } else {
        return `${marketCap.toFixed(0)}`;
      }
    }

    // Add tooltips for better user understanding
    function addTooltips() {
      const tooltips = {
        'activeOpportunities': 'Number of trading pairs with spreads above your minimum threshold',
        'bestMargin': 'Largest price difference found between exchanges',
        'avgSpread': 'Average price difference across all opportunities',
        'dataQuality': 'Percentage of successful API calls and data freshness'
      };

      Object.entries(tooltips).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
          element.title = text;
          element.style.cursor = 'help';
        }
      });
    }

    // Performance monitoring
    let performanceMetrics = {
      apiCallCount: 0,
      successfulCalls: 0,
      averageResponseTime: 0,
      lastCallTime: 0
    };

    function updatePerformanceMetrics(responseTime, success) {
      performanceMetrics.apiCallCount++;
      if (success) performanceMetrics.successfulCalls++;
      
      performanceMetrics.averageResponseTime = 
        (performanceMetrics.averageResponseTime * (performanceMetrics.apiCallCount - 1) + responseTime) / 
        performanceMetrics.apiCallCount;
      
      performanceMetrics.lastCallTime = Date.now();
      
      // Update data quality based on success rate
      const successRate = (performanceMetrics.successfulCalls / performanceMetrics.apiCallCount) * 100;
      document.getElementById('dataQuality').textContent = `${Math.round(successRate)}%`;
      document.getElementById('qualityFill').style.width = `${successRate}%`;
    }

    // Export functionality for advanced users
    function exportOpportunities() {
      if (opportunities.length === 0) {
        alert('No opportunities to export');
        return;
      }

      const csvContent = [
        ['Coin', 'Symbol', 'Buy Exchange', 'Buy Price', 'Sell Exchange', 'Sell Price', 'Spread USD', 'Spread %', 'Market Cap', 'Timestamp'],
        ...opportunities.map(op => [
          op.coin.name,
          op.coin.symbol,
          op.buyExchange,
          op.buyPrice.toFixed(4),
          op.sellExchange,
          op.sellPrice.toFixed(4),
          op.spread.toFixed(2),
          op.spreadPercentage.toFixed(3),
          op.marketCap,
          new Date(op.timestamp).toISOString()
        ])
      ].map(row => row.join(',')).join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `arbitrage_opportunities_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Add export button (you could add this to the UI if needed)
    console.log('Export function available: exportOpportunities()');

    // Initialize tooltips after DOM loads
    setTimeout(addTooltips, 1000);

    // Console info for developers
    console.log(`
    ðŸš€ S2 Hub Real-Time Arbitrage Platform
    ======================================
    
    Features:
    â€¢ Live cryptocurrency price data from CoinGecko
    â€¢ Real-time arbitrage opportunity detection
    â€¢ Simulated exchange price variations
    â€¢ Auto-refresh every 2 minutes
    â€¢ Responsive design with glassmorphism UI
    
    Available functions:
    â€¢ refreshRealData() - Manual refresh
    â€¢ exportOpportunities() - Export data as CSV
    
    Keyboard shortcuts:
    â€¢ Ctrl+R / Cmd+R - Refresh data
    
    Note: This is a demonstration platform using simulated exchange
    price variations based on real market data from CoinGecko.
    `);
  </script>
</body>
</html>